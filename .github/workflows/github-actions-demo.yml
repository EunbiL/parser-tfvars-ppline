name: GitHub Actions Demo for parser-tfvars
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:

  Checkout-repository:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - name: Upload Files
        uses: actions/upload-artifact@v2
        with:
            name: shared-files
            path: .

  Tfvars-parser:
    needs: Checkout-repository
    runs-on: ubuntu-latest
    steps:
      - name: Download All Files
        uses: actions/download-artifact@v2
        with:
            name: shared-files
      - name: Check for tfvars file
        run: |
          if [ -f *.tfvars ]; then
              echo "tfvars file exists"
          else
              echo "tfvars file does not exist"
              exit 1
          fi
      - name: Install pyhcl
        run: pip install pyhcl
      - name: Execute the script
        run: python tfvars_parser.py --input_tfvars_file file-test.tfvars
      - name: Read output file
        run: cat output.tfvars
      - name: Upload output file
        uses: actions/upload-artifact@v2
        with:
            name: shared-files
            path: output.tfvars

  Check-output-file:
    needs: Tfvars-parser
    runs-on: ubuntu-latest
    environment:
        name: dev
    steps:
      - name: If I download the artifact before, is it stored always during the pipeline?
        uses: actions/download-artifact@v2
      - name: List files in the repository
        run: |
          cd ${{ github.workspace }}/shared-files
          cat output.tfvars
