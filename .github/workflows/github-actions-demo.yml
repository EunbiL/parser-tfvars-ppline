name: GitHub Actions Demo for parser-tfvars
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:
  Start-pipeline:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - name: Upload Files
        uses: actions/upload-artifact@v2
        with:
            name: shared-files
            path: .

  Install-prerequirement:
    needs: Start-pipeline
    runs-on: ubuntu-latest
    steps:
      - name: Download All Files
        uses: actions/download-artifact@v2
        with:
            name: shared-files
      - name: Check for tfvars file
        run: |
          if [ -f *.tfvars ]; then
              echo "tfvars file exists"
          else
              echo "tfvars file does not exist"
              exit 1
          fi
      - name: Install pyhcl
        run: pip install pyhcl
      - name: Execute the script
        run: python tfvars_parser.py --input_tfvars_file file-test.tfvars
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - name: Read output file
        run: cat output.tfvars
      - name: Upload output file
        uses: actions/upload-artifact@v2
        with:
            name: shared-files
            path: output.tfvars
            
  Test-Artifact:
    needs: Install-prerequirement
    runs-on: ubuntu-latest
    steps:
      - name: If I download the artifact before, is it stored always during the pipeline?
        uses: actions/download-artifact@v2
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}/shared-files
          cat output.tfvars
